{% extends "base.html" %}

{% load admin_urls %}

{% block extra_head %}
    <link rel="stylesheet" 
        href="/static/jquery-ui-1.9.2.custom/css/ahernp-theme/jquery-ui-1.9.2.custom.min.css" 
    />
    <style type="text/css">
        p.feedreader_menu {font-size: small; margin: 0;}
        p.feedreader_subtitle {font-size: small;}
        #content {width: 80%;}
        .feed_entry {padding: 0.2em 0.5em; margin: 0.5em; border: 1px solid #046; border-radius: 1em;}
        .secondary_link {text-decoration:none;}
        #spinner {position: fixed; top: 50%; left: 50%; margin-top: -64px; margin-left: -64px; z-index: 3;}
    </style>
    <script type="text/javascript">
        $(function() {
            $('#accordion').accordion({heightStyle: 'content', collapsible: true, active: false});
            $('.ui-accordion-content').css({'padding': '1em'});
            $('#spinner').hide().ajaxStart(function() {$(this).show();})
                                .ajaxStop(function() {$(this).hide();});
            $('.load_request').click(function() {
                $('#entries').load('/feedreader/get_feeds/','group='+$(this).attr('id'));
            });
        });
    </script>
{% endblock %}

{% block title %}ahernp.com: Feed Reader{% endblock %}

{% block nav_path %}<a href="/">ahernp.com</a> &rsaquo; Feed Reader{% endblock %}

{% block content %}
    <h1>Feed Reader</h1>
    <div style="width:20%;float:left">
        <h3><a href="{% url 'feedreader.views.feeds' %}">All stories</a></h3>
        <div id="accordion">
            {% for group in groups %}
                <h3 id="{{ group.id }}" class="load_request">{{ group.name }}</h3>
                <div>
                    <p class="feedreader_menu">
                        <a href="{% url 'feedreader.views.feeds' %}?group={{group.id}}">
                            All {{ group.name }}
                        </a>
                        &nbsp;
                        <a href="{% url 'feedreader.views.feeds' %}?group={{group.id}}&poll=1"
                            title="Poll {{ group.name }} feeds"
                            class="secondary_link">
                            &darr;
                        </a>
                    <p>
                    {% for feed in group.feed_set.all %}
                        <p class="feedreader_menu">
                            <a href="{% url 'feedreader.views.feeds' %}?feed={{feed.id}}" 
                                title="{{ feed.description }}">
                                {{ feed.title }}
                            </a>
                            &nbsp;
                            <a href="{% url 'feedreader.views.feeds' %}?feed={{feed.id}}&poll=1" 
                                title="Poll {{ feed.title }} feed"
                                class="secondary_link">
                                &darr;
                            </a>
                        </p>
                    {% endfor %}
                </div>
            {% endfor %}
        </div> <!-- accordion -->
        {% for feed in no_group %}
            <p>
                <a href="{% url 'feedreader.views.feeds' %}?feed={{feed.id}}" 
                    title="{{ feed.description }}">
                    {{ feed.title }}
                </a>
                &nbsp;
                <a href="{% url 'feedreader.views.feeds' %}?feed={{feed.id}}&poll=1" 
                    title="Poll {{ feed.title }} feed"
                    class="secondary_link">
                    &darr;
                </a>
            </p>
        {% endfor %}
    </div>
    <div id="entries" style="width:75%;float:left;padding-left:1em;">
        <h2>{{ entries_header }}</h2>
        {% if entries %}
            {% for entry in entries %}
                <div class="feed_entry">
                    <h3><a href="{{ entry.link }}">{{ entry.title }}</a></h3>
                    <p class="feedreader_subtitle">
                        from 
                        <a href="{{ entry.feed.link }}" title="{{ entry.feed.description }}">
                            {{ entry.feed.title}}
                        </a>
                        on {{ entry.published_time|date:"d M Y" }} ({{ entry.published_time|timesince }} ago)
                    </p>
                    <p>{{ entry.description|safe }}</p>
                </div>
            {% endfor %}
        {% else %}
            <p>No stories found</p>
        {% endif %}
    </div>
    <div style="clear:both"></div>
    <div id="spinner">
        <img src="{{ STATIC_URL }}spinner.gif" alt="Please wait" title="Please Wait" />
    </div>
{% endblock %}

{% block footer %}
    <a href="{% url feed_meta|admin_urlname:"changelist" %}" title="Edit Feeds">Edit</a>
    <a href="/accounts/logout">Logout</a>
{% endblock %}